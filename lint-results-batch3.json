[{"filePath":"/Users/acvisuals/.gemini/antigravity/playground/numa-budget/src/domain/money/__tests__/currency-refactor.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1900,1903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1900,1903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1994,1997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1994,1997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2344,2347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2344,2347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from \"vitest\"\nimport { parseCurrencyToCents } from \"../currency\"\nimport { getSignedCents, normalizeTransactionAmount, formatCentsSignedFromType } from \"@/domain/transactions\"\nimport { Transaction } from \"@/features/transactions/api/types\"\n\ndescribe(\"Currency Refactor\", () => {\n    describe(\"parseCurrencyToCents\", () => {\n        it(\"parses diverse formats correctly\", () => {\n            expect(parseCurrencyToCents(\"€30,00\")).toBe(3000)\n            expect(parseCurrencyToCents(\"€30.00\")).toBe(3000)\n            expect(parseCurrencyToCents(\"1.234,56\")).toBe(123456)\n            expect(parseCurrencyToCents(\"1,234.56\")).toBe(123456)\n            expect(parseCurrencyToCents(\"-€30,00\")).toBe(-3000)\n            expect(parseCurrencyToCents(\"15\")).toBe(1500)\n        })\n\n        it(\"handles ambiguous cases with heuristics\", () => {\n            expect(parseCurrencyToCents(\"1.234\")).toBe(123400) // Thousand separator assumption\n        })\n\n        it(\"is robust to garbage input\", () => {\n            expect(parseCurrencyToCents(\"abc\")).toBe(0)\n            expect(parseCurrencyToCents(\"\")).toBe(0)\n        })\n    })\n\n    describe(\"getSignedCents\", () => {\n        it(\"respects transaction type for sign\", () => {\n            const expense = { type: \"expense\", amountCents: 1000 } as Transaction\n            expect(getSignedCents(expense)).toBe(-1000)\n\n            const income = { type: \"income\", amountCents: 1000 } as Transaction\n            expect(getSignedCents(income)).toBe(1000)\n        })\n    })\n\n    describe(\"normalizeTransactionAmount\", () => {\n        it(\"backfills amountCents from raw data\", () => {\n            const rawT = {\n                id: \"1\",\n                type: \"expense\",\n                amountCents: \"1050\" // String from storage/json\n            } as unknown as Transaction\n\n            const normalized = normalizeTransactionAmount(rawT as any)\n\n            expect(normalized.amountCents).toBe(1050)\n            expect((normalized as any).amount).toBeUndefined()\n        })\n\n        it(\"migrates categoryId\", () => {\n            const rawT = {\n                id: \"1\",\n                type: \"expense\",\n                amountCents: 500,\n                categoryId: \"legacy-cat\"\n            } as unknown as Transaction\n\n            const normalized = normalizeTransactionAmount(rawT as any)\n\n            expect(normalized.amountCents).toBe(500)\n            // assuming migrateCategoryId(\"legacy-cat\") returns something or remains if no map\n        })\n    })\n\n    describe(\"Dashboard/Budget Logic Simulation\", () => {\n        it(\"calculates salary correctly using integer math\", () => {\n            const transactions = [\n                { type: \"income\", amountCents: 125033 }, // 1250.33\n                { type: \"expense\", amountCents: 4510 }   // 45.10\n            ] as Transaction[]\n\n            const totalIncome = transactions\n                .filter(t => t.type === \"income\")\n                .reduce((acc, t) => acc + Math.abs(getSignedCents(t)), 0)\n\n            const totalExpense = transactions\n                .filter(t => t.type === \"expense\")\n                .reduce((acc, t) => acc + Math.abs(getSignedCents(t)), 0)\n\n            expect(totalIncome).toBe(125033)\n            expect(totalExpense).toBe(4510)\n\n            const balance = (totalIncome - totalExpense) / 100\n            expect(balance).toBe(1205.23)\n        })\n    })\n})\n","usedDeprecatedRules":[]},{"filePath":"/Users/acvisuals/.gemini/antigravity/playground/numa-budget/src/features/dashboard/components/charts/spending-composition-card.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4230,4233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4230,4233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":115,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":118,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4558,4561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4558,4561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":164,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":167,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4607,4610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4607,4610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":169,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":172,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4796,4799],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4796,4799],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":148,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":151,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5119,5122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5119,5122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":115,"column":111,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":115,"endColumn":114,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5267,5270],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5267,5270],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6147,6150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6147,6150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6212,6215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6212,6215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":115,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":118,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6271,6274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6271,6274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":170,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":173,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6326,6329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6326,6329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":224,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9628,9631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9628,9631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":224,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9670,9673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9670,9673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10614,10617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10614,10617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useMemo, useState } from \"react\"\nimport { useCurrency } from \"@/features/settings/api/use-currency\"\nimport { formatCents } from \"@/domain/money/currency\"\nimport { PremiumChartSection } from \"./premium-chart-section\"\nimport * as echarts from \"echarts\"\nimport { getCategoryById } from \"@/features/categories/config\"\nimport { useCategories } from \"@/features/categories/api/use-categories\"\nimport { useSettings } from \"@/features/settings/api/use-settings\"\nimport { Transaction } from \"@/features/transactions/api/types\"\nimport { DashboardTimeFilter } from \"../../api/types\"\n\ninterface SpendingCompositionCardProps {\n    transactions: Transaction[]\n    filter: DashboardTimeFilter\n    isLoading?: boolean\n}\n\nconst TOP_N_CATEGORIES = 5\nconst SYNTHETIC_ALTRI_ID = \"altro-synthetic\"\n\nexport function SpendingCompositionCard({ transactions, filter, isLoading: isExternalLoading }: SpendingCompositionCardProps) {\n    const { currency, locale } = useCurrency()\n    const { data: categories = [], isLoading: isCategoriesLoading } = useCategories()\n    const { data: settings } = useSettings()\n    const isDarkMode = settings?.theme === \"dark\" || (settings?.theme === \"system\" && typeof window !== \"undefined\" && window.matchMedia(\"(prefers-color-scheme: dark)\").matches)\n    const isLoading = isExternalLoading || isCategoriesLoading\n\n    const [highlightedCategory, setHighlightedCategory] = useState<string | null>(null)\n\n    const chartData = useMemo(() => {\n        if (!transactions || transactions.length === 0) return []\n\n        const periodTransactions = transactions.filter(t => {\n            const date = new Date(t.timestamp)\n            const startDate = new Date(filter.period + \"-01\")\n            startDate.setDate(1)\n\n            const endDate = new Date(filter.period + \"-01\")\n            endDate.setMonth(endDate.getMonth() + 1)\n            endDate.setDate(0)\n\n            if (filter.mode === \"range\" && filter.months) {\n                startDate.setMonth(startDate.getMonth() - (filter.months - 1))\n            }\n\n            return t.type === \"expense\" && date >= startDate && date <= endDate\n        })\n\n        const periodCategoryTotals: Record<string, number> = {}\n        periodTransactions.forEach(t => {\n            const val = Math.abs(t.amountCents)\n            periodCategoryTotals[t.categoryId] = (periodCategoryTotals[t.categoryId] || 0) + val\n        })\n\n        const sortedCategories = Object.entries(periodCategoryTotals)\n            .sort(([, a], [, b]) => b - a)\n\n        const topCats = sortedCategories.slice(0, TOP_N_CATEGORIES)\n        const othersSum = sortedCategories.slice(TOP_N_CATEGORIES)\n            .reduce((acc, [, val]) => acc + val, 0)\n\n        const data = topCats.map(([id, value]) => {\n            const config = getCategoryById(id, categories)\n            return {\n                id,\n                name: config?.label || \"Sconosciuta\",\n                value,\n                itemStyle: {\n                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [\n                        { offset: 0, color: config?.hexColor || \"#6366f1\" },\n                        { offset: 1, color: (config?.hexColor || \"#6366f1\") + \"88\" }\n                    ])\n                }\n            }\n        })\n\n        if (othersSum > 0) {\n            data.push({\n                id: SYNTHETIC_ALTRI_ID,\n                name: \"Altri\",\n                value: othersSum,\n                itemStyle: {\n                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [\n                        { offset: 0, color: \"#94a3b8\" },\n                        { offset: 1, color: \"#94a3b888\" }\n                    ])\n                }\n            })\n        }\n\n        return data\n    }, [transactions, filter, categories])\n\n    const option: echarts.EChartsOption = useMemo(() => {\n        if (!chartData.length) return {}\n        return {\n            tooltip: {\n                trigger: 'item',\n                backgroundColor: 'rgba(15, 23, 42, 0.95)',\n                borderColor: 'rgba(255, 255, 255, 0.1)',\n                borderWidth: 1,\n                padding: [12, 16],\n                textStyle: { color: '#f8fafc', fontSize: 13 },\n                formatter: (params: any) => {\n                    return `\n                        <div style=\"display: flex; flex-direction: column; gap: 4px;\">\n                            <div style=\"display: flex; align-items: center; gap: 8px;\">\n                                <div style=\"width: 8px; height: 8px; border-radius: 50%; background: ${(params as any).color?.colorStops?.[0]?.color || (params as any).color};\"></div>\n                                <span style=\"font-weight: 700; opacity: 0.8; text-transform: uppercase; font-size: 10px; tracking: 0.1em; color: #94a3b8;\">${(params as any).name}</span>\n                            </div>\n                            <div style=\"display: flex; justify-content: space-between; align-items: baseline; gap: 24px;\">\n                                <span style=\"font-size: 16px; font-weight: 900; letter-spacing: -0.02em; color: #ffffff;\">${formatCents((params as any).value, currency, locale)}</span>\n                                <span style=\"font-size: 11px; font-weight: 700; color: #6366f1;\">${(params as any).percent}%</span>\n                            </div>\n                        </div>\n                    `\n                }\n            },\n            series: [\n                {\n                    name: 'Composizione Spese',\n                    type: 'pie',\n                    radius: ['55%', '78%'],\n                    center: ['50%', '50%'],\n                    avoidLabelOverlap: true,\n                    itemStyle: {\n                        borderRadius: 16,\n                        borderColor: 'transparent',\n                        borderWidth: 4,\n                        shadowBlur: 30,\n                        shadowColor: 'rgba(0,0,0,0.25)'\n                    },\n                    label: {\n                        show: true,\n                        position: 'outside',\n                        padding: [0, -35],\n                        formatter: (params: any) => {\n                            return `{name|${(params as any).name.toUpperCase()}}\\n{value|${formatCents((params as any).value, currency, locale)}}\\n{percent|${(params as any).percent}%}`\n                        },\n                        rich: {\n                            name: {\n                                color: '#94a3b8',\n                                fontSize: 9,\n                                fontWeight: 800,\n                                padding: [0, 0, 4, 0],\n                                align: 'center'\n                            },\n                            value: {\n                                color: isDarkMode ? '#f8fafc' : '#1e293b',\n                                fontSize: 13,\n                                fontWeight: 900,\n                                padding: [0, 0, 2, 0],\n                                align: 'center'\n                            },\n                            percent: {\n                                color: '#6366f1',\n                                fontSize: 10,\n                                fontWeight: 800,\n                                align: 'center'\n                            }\n                        }\n                    },\n                    emphasis: {\n                        scale: true,\n                        scaleSize: 15,\n                        focus: 'self',\n                        itemStyle: {\n                            shadowBlur: 65,\n                            shadowColor: 'rgba(99, 102, 241, 0.65)'\n                        },\n                        label: {\n                            show: true,\n                            rich: {\n                                name: {\n                                    fontSize: 12,\n                                    fontWeight: 900,\n                                    padding: [0, 0, 8, 0],\n                                    color: isDarkMode ? '#f8fafc' : '#1e293b'\n                                },\n                                value: {\n                                    fontSize: 18,\n                                    fontWeight: 900,\n                                    padding: [0, 0, 4, 0]\n                                },\n                                percent: {\n                                    fontSize: 13,\n                                    fontWeight: 900\n                                }\n                            }\n                        }\n                    },\n                    blur: {\n                        label: {\n                            show: false\n                        },\n                        itemStyle: {\n                            opacity: 0.15,\n                            shadowBlur: 0\n                        },\n                        labelLine: {\n                            show: false\n                        }\n                    },\n                    data: chartData,\n                    animationType: 'scale',\n                    animationEasing: 'cubicOut',\n                    animationDuration: 1200\n                }\n            ],\n            graphic: []\n        }\n    }, [chartData, currency, locale, isDarkMode])\n\n    return (\n        <PremiumChartSection\n            title=\"Composizione Spese\"\n            description=\"Visualizzazione immersiva dell'andamento mensile\"\n            option={option}\n            isLoading={isLoading}\n            hasData={chartData.length > 0}\n            onEvents={{\n                'mouseover': (params: any) => setHighlightedCategory((params as any).data.id),\n                'mouseout': () => setHighlightedCategory(null)\n            }}\n        >\n            <div className=\"mt-4 flex flex-wrap justify-center gap-12\">\n                {chartData.slice(0, 3).map((item, idx) => (\n                    <div key={item.id} className=\"flex flex-col items-center gap-1.5 group cursor-default\">\n                        <span className=\"text-[10px] font-black uppercase tracking-[0.25em] text-muted-foreground/40 group-hover:text-primary transition-colors\">\n                            TOP {idx + 1}\n                        </span>\n                        <span className=\"text-sm font-bold text-foreground\">\n                            {item.name}\n                        </span>\n                        <div\n                            className=\"h-[3px] w-12 rounded-full transition-all duration-300 group-hover:w-16\"\n                            style={{ background: ((item.itemStyle?.color as any)?.colorStops?.[0]?.color || item.itemStyle?.color) as string }}\n                        />\n                    </div>\n                ))}\n            </div>\n        </PremiumChartSection>\n    )\n}\n","usedDeprecatedRules":[]}]
