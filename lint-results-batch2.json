[{"filePath":"/Users/acvisuals/.gemini/antigravity/playground/numa-budget/src/domain/money/__tests__/currency-refactor.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1900,1903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1900,1903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1994,1997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1994,1997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2344,2347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2344,2347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from \"vitest\"\nimport { parseCurrencyToCents } from \"../currency\"\nimport { getSignedCents, normalizeTransactionAmount, formatCentsSignedFromType } from \"@/domain/transactions\"\nimport { Transaction } from \"@/features/transactions/api/types\"\n\ndescribe(\"Currency Refactor\", () => {\n    describe(\"parseCurrencyToCents\", () => {\n        it(\"parses diverse formats correctly\", () => {\n            expect(parseCurrencyToCents(\"€30,00\")).toBe(3000)\n            expect(parseCurrencyToCents(\"€30.00\")).toBe(3000)\n            expect(parseCurrencyToCents(\"1.234,56\")).toBe(123456)\n            expect(parseCurrencyToCents(\"1,234.56\")).toBe(123456)\n            expect(parseCurrencyToCents(\"-€30,00\")).toBe(-3000)\n            expect(parseCurrencyToCents(\"15\")).toBe(1500)\n        })\n\n        it(\"handles ambiguous cases with heuristics\", () => {\n            expect(parseCurrencyToCents(\"1.234\")).toBe(123400) // Thousand separator assumption\n        })\n\n        it(\"is robust to garbage input\", () => {\n            expect(parseCurrencyToCents(\"abc\")).toBe(0)\n            expect(parseCurrencyToCents(\"\")).toBe(0)\n        })\n    })\n\n    describe(\"getSignedCents\", () => {\n        it(\"respects transaction type for sign\", () => {\n            const expense = { type: \"expense\", amountCents: 1000 } as Transaction\n            expect(getSignedCents(expense)).toBe(-1000)\n\n            const income = { type: \"income\", amountCents: 1000 } as Transaction\n            expect(getSignedCents(income)).toBe(1000)\n        })\n    })\n\n    describe(\"normalizeTransactionAmount\", () => {\n        it(\"backfills amountCents from raw data\", () => {\n            const rawT = {\n                id: \"1\",\n                type: \"expense\",\n                amountCents: \"1050\" // String from storage/json\n            } as unknown as Transaction\n\n            const normalized = normalizeTransactionAmount(rawT as any)\n\n            expect(normalized.amountCents).toBe(1050)\n            expect((normalized as any).amount).toBeUndefined()\n        })\n\n        it(\"migrates categoryId\", () => {\n            const rawT = {\n                id: \"1\",\n                type: \"expense\",\n                amountCents: 500,\n                categoryId: \"legacy-cat\"\n            } as unknown as Transaction\n\n            const normalized = normalizeTransactionAmount(rawT as any)\n\n            expect(normalized.amountCents).toBe(500)\n            // assuming migrateCategoryId(\"legacy-cat\") returns something or remains if no map\n        })\n    })\n\n    describe(\"Dashboard/Budget Logic Simulation\", () => {\n        it(\"calculates salary correctly using integer math\", () => {\n            const transactions = [\n                { type: \"income\", amountCents: 125033 }, // 1250.33\n                { type: \"expense\", amountCents: 4510 }   // 45.10\n            ] as Transaction[]\n\n            const totalIncome = transactions\n                .filter(t => t.type === \"income\")\n                .reduce((acc, t) => acc + Math.abs(getSignedCents(t)), 0)\n\n            const totalExpense = transactions\n                .filter(t => t.type === \"expense\")\n                .reduce((acc, t) => acc + Math.abs(getSignedCents(t)), 0)\n\n            expect(totalIncome).toBe(125033)\n            expect(totalExpense).toBe(4510)\n\n            const balance = (totalIncome - totalExpense) / 100\n            expect(balance).toBe(1205.23)\n        })\n    })\n})\n","usedDeprecatedRules":[]},{"filePath":"/Users/acvisuals/.gemini/antigravity/playground/numa-budget/src/domain/narration/__tests__/semantic-enforcement.test.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":62,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":62,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2553,2566],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3114,3117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3114,3117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":107,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":107,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[4361,4374],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":113,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":113,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4575,4578],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4575,4578],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":135,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":135,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[5401,5414],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":153,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":153,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[6085,6098],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6258,6261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6258,6261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":167,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":167,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[6662,6675],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":171,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6827,6830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6827,6830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":183,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":183,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[7310,7323],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7475,7478],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7475,7478],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":197,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":197,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[7850,7863],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":201,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8016,8019],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8016,8019],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":211,"column":13,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":211,"endColumn":26,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[8345,8358],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8507,8510],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8507,8510],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { describe, it, expect } from \"vitest\"\nimport { narrateAdvisor } from \"../advisor.narrator\"\nimport { deriveAdvisorState, deriveSnapshotState, deriveKPIState } from \"../derive-state\"\nimport { narrateSnapshot, narrateKPI } from \"../\"\nimport { AdvisorFacts } from \"../types\"\n\n// GLOBAL SEMANTIC ENFORCEMENT SUITE\n// =================================\n// Ensures no regressions on critical semantic rules:\n// 1. No positive/celebratory terms in Deficit.\n// 2. No \"Stable\"/\"Good\" states for Micro-surplus (<5%).\n// 3. Strict state derivation based on net buffer.\n\ndescribe(\"Global Semantic Anti-Regression\", () => {\n\n    const BANNED_POSITIVE_TERMS = [\"risparmio\", \"efficienza\", \"surplus\", \"stabile\", \"ottimo lavoro\", \"sotto controllo\"]\n\n    // ==========================================\n    // SCENARIO 1: DEFICIT (Out > In)\n    // ==========================================\n    describe(\"Scenario: DEFICIT (Income <= Expenses)\", () => {\n        const deficitFacts = {\n            predictedIncomeCents: 100000,\n            predictedExpensesCents: 120000,\n            deltaCents: -20000,\n            deltaPercent: -20,\n            historicalMonthsCount: 3,\n            subscriptionCount: 0,\n            subscriptionTotalYearlyCents: 0\n        }\n\n        it(\"Advisor: Should NOT contain banned positive terms\", () => {\n            const state = deriveAdvisorState(deficitFacts)\n            expect(state).toBe(\"deficit\")\n            const text = narrateAdvisor(deficitFacts, state).text.toLowerCase()\n\n            BANNED_POSITIVE_TERMS.forEach(term => {\n                expect(text).not.toContain(term)\n            })\n            expect(text).toContain(\"disavanzo\")\n        })\n    })\n\n    // ==========================================\n    // SCENARIO 2: MICRO-SURPLUS (Buffer < 5%)\n    // ==========================================\n    describe(\"Scenario: MICRO-SURPLUS (0 < Buffer < 5%)\", () => {\n        // Income 1000, Exp 970 => Balance 30. Buffer = 30/1000 = 3%\n        const income = 100000\n        const balance = 3000\n\n        it(\"Snapshot: Should be STRAINED/ATTENTION (not Stable)\", () => {\n            const facts = {\n                snapshotId: \"test\", periodLabel: \"Now\",\n                incomeFormatted: \"€1.000\", expensesFormatted: \"€970\", balanceFormatted: \"€30\",\n                balanceCents: balance,\n                incomeCents: income,\n                // defaults\n                utilizationPercent: undefined, superfluousPercent: undefined,\n                elapsedRatio: 0.5 // Mid-month for standard tests\n            }\n            // @ts-ignore\n            const state = deriveSnapshotState(facts)\n\n            expect(state).not.toBe(\"stable\")\n            expect(state).not.toBe(\"thriving\")\n            // Expect degradation\n            expect([\"strained\", \"calm\", \"attention\"]).toContain(state) // inclusive check\n\n            const text = narrateSnapshot(facts, state).text.toLowerCase()\n            expect(text).not.toContain(\"stabile\")\n            expect(text).not.toContain(\"ottimo\")\n        })\n\n        it(\"KPI Balance: Should be ATTENTION (not Good)\", () => {\n            const facts: any = {\n                kpiId: \"balance\",\n                valueFormatted: \"€30\",\n                tone: \"positive\", // Input tone might be positive, but derivation must downgrade\n                bufferRatio: 0.03\n            }\n            const state = deriveKPIState(facts)\n            expect(state).toBe(\"attention\")\n            expect(state).not.toBe(\"good\")\n\n            const text = narrateKPI(facts, state).text.toLowerCase()\n            expect(text).not.toContain(\"ottimo\")\n        })\n    })\n\n    // ==========================================\n    // SCENARIO 3: SOLID SURPLUS (Buffer >= 5%)\n    // ==========================================\n    describe(\"Scenario: SOLID SURPLUS (Buffer >= 5%)\", () => {\n        // Income 1000, Exp 940 => Balance 60. Buffer = 60/1000 = 6%\n        const income = 100000\n        const balance = 6000\n\n        it(\"Snapshot: Should be STABLE or THRIVING\", () => {\n            const facts = {\n                snapshotId: \"test\", periodLabel: \"Now\",\n                incomeFormatted: \"€1.000\", expensesFormatted: \"€940\", balanceFormatted: \"€60\",\n                balanceCents: balance,\n                incomeCents: income,\n                elapsedRatio: 0.5 // satisfy B2 (pacing required)\n            }\n            // @ts-ignore\n            const state = deriveSnapshotState(facts)\n            expect([\"stable\", \"thriving\"]).toContain(state)\n        })\n\n        it(\"KPI Balance: Should be GOOD\", () => {\n            const facts: any = {\n                kpiId: \"balance\",\n                valueFormatted: \"€60\",\n                tone: \"positive\",\n                bufferRatio: 0.06\n            }\n            const state = deriveKPIState(facts)\n            expect(state).toBe(\"good\")\n        })\n    })\n\n    // ==========================================\n    // SCENARIO 4: MISSING DATA\n    // ==========================================\n    describe(\"Scenario: MISSING INCOME DATA\", () => {\n        it(\"Snapshot: Positive Balance but Unknown Income -> CALM (not Stable)\", () => {\n            const facts = {\n                snapshotId: \"test\", periodLabel: \"Now\",\n                incomeFormatted: \"€0\", expensesFormatted: \"€0\", balanceFormatted: \"€10\",\n                balanceCents: 1000,\n                incomeCents: 0 // Missing/Zero\n            }\n            // @ts-ignore\n            const state = deriveSnapshotState(facts)\n            expect(state).toBe(\"calm\")\n            expect(state).not.toBe(\"stable\")\n        })\n    })\n\n    // ==========================================\n    // SCENARIO 5: BUDGET PACING (B1-B6)\n    // ==========================================\n    describe(\"Scenario: BUDGET PACING (Rules B1-B6)\", () => {\n\n        it(\"B1: Early month (elapsed < 15%) -> early_uncertain\", () => {\n            const facts = {\n                snapshotId: \"test\", periodLabel: \"Now\",\n                balanceCents: 10000, incomeCents: 100000,\n                utilizationPercent: 5, elapsedRatio: 0.1 // day 3/30\n            }\n            // @ts-ignore\n            const state = deriveSnapshotState(facts)\n            expect(state).toBe(\"early_uncertain\")\n\n            const narration = narrateSnapshot(facts as any, state)\n            expect(narration.text).toContain(\"iniziato\")\n        })\n\n        it(\"B3: Utilization > Elapsed (Pacing Off) -> at_risk\", () => {\n            const facts = {\n                snapshotId: \"test\", periodLabel: \"Now\",\n                balanceCents: 50000, incomeCents: 100000,\n                utilizationPercent: 60, elapsedRatio: 0.4 // spent 60% in 40% time\n            }\n            // @ts-ignore\n            const state = deriveSnapshotState(facts)\n            expect(state).toBe(\"at_risk\")\n\n            const narration = narrateSnapshot(facts as any, state)\n            const text = narration.text.toLowerCase()\n            expect(text.match(/inferiore|ritmo|proiezione|elevato/)).toBeTruthy()\n        })\n\n        it(\"B4: Projected Overrun -> at_risk\", () => {\n            const facts = {\n                snapshotId: \"test\", periodLabel: \"Now\",\n                balanceCents: 10000, incomeCents: 100000,\n                utilizationPercent: 50, elapsedRatio: 0.4,\n                isProjectedOverrun: true\n            }\n            // @ts-ignore\n            const state = deriveSnapshotState(facts)\n            expect(state).toBe(\"at_risk\")\n\n            const narration = narrateSnapshot(facts as any, state)\n            expect(narration.text).toContain(\"proiezione\")\n        })\n\n        it(\"B5: Over Budget -> critical (or equivalent)\", () => {\n            const facts = {\n                snapshotId: \"test\", periodLabel: \"Now\",\n                balanceCents: -500, incomeCents: 100000,\n                utilizationPercent: 110, elapsedRatio: 0.9\n            }\n            // @ts-ignore\n            const state = deriveSnapshotState(facts)\n            expect(state).toBe(\"critical\")\n\n            const narration = narrateSnapshot(facts as any, state)\n            expect(narration.text).toContain(\"superato\")\n        })\n\n        it(\"B6: Data Incomplete -> calm\", () => {\n            const facts = {\n                snapshotId: \"test\", periodLabel: \"Now\",\n                balanceCents: 0, incomeCents: 0,\n                isDataIncomplete: true\n            }\n            // @ts-ignore\n            const state = deriveSnapshotState(facts)\n            expect(state).toBe(\"calm\")\n\n            const narration = narrateSnapshot(facts as any, state)\n            expect(narration.text).toContain(\"limitati\")\n        })\n    })\n})\n","usedDeprecatedRules":[]},{"filePath":"/Users/acvisuals/.gemini/antigravity/playground/numa-budget/src/domain/transactions/utils.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1797,1800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1797,1800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Transaction, TransactionType } from \"./types\"\nimport { formatSignedCents, parseCurrencyToCents } from \"@/domain/money/currency\"\nimport { getCategoryById } from \"@/domain/categories/utils\"\nimport { migrateCategoryId } from \"@/domain/categories/migration\"\n\n/**\n * Helper to get signed cents from amountCents.\n * Income is positive, Expense is negative.\n */\nexport function getSignedCents(t: Transaction): number {\n    const absCents = Math.abs(t.amountCents || 0)\n    if (absCents === 0) return 0\n    return t.type === \"income\" ? absCents : -absCents\n}\n\n/**\n * Formats string amount from signed cents.\n * e.g. 1050 (income) -> \"+€10,50\"\n * e.g. -1050 (expense) -> \"-€10,50\"\n */\nexport function formatCentsSignedFromType(absCents: number, type: TransactionType): string {\n    const signedValue = type === \"income\" ? absCents : -Math.abs(absCents)\n    return formatSignedCents(signedValue)\n}\n\n/**\n * Normalizes a transaction by ensuring amountCents is present.\n * Migration: Automatically migrates legacy category IDs to the new system.\n * Does NOT mutate the input object.\n */\nexport function normalizeTransactionAmount(t: Partial<Transaction> & Record<string, unknown>): Transaction {\n    const raw = t as Transaction\n\n    // 0. Migrate categoryId if it's legacy\n    const migratedId = raw.categoryId ? migrateCategoryId(raw.categoryId) : raw.categoryId\n\n    // 1. Ensure amountCents is a number\n    const absCents = Math.abs(Number(raw.amountCents) || 0)\n\n    // 2. Return updated object (no more legacy 'amount' string)\n    return {\n        ...raw,\n        categoryId: migratedId,\n        amountCents: absCents\n    }\n}\n\n/**\n * Helper to check rule-based superfluous status\n */\nexport const calculateSuperfluousStatus = (\n    categoryId: string,\n    type: TransactionType,\n    categories: any[] // Using any[] to avoid circular dependency if Category is in domain/categories/types\n): boolean => {\n    if (type === \"income\") return false\n    const cat = getCategoryById(categoryId, categories)\n    return cat?.spendingNature === \"superfluous\"\n}\n\n/**\n * Resolve the budget group for a transaction, taking into account manual overrides.\n * Aligns budget actuals with the \"isSuperfluous\" logic used in Dashboard/KPIs.\n */\nexport function resolveBudgetGroupForTransaction(\n    transaction: Transaction,\n    categoryNature?: \"essential\" | \"comfort\" | \"superfluous\"\n): \"essential\" | \"comfort\" | \"superfluous\" {\n    // 1. Manual override: if marked as superfluous, it ALWAYS goes to 'superfluous'\n    if (transaction.isSuperfluous === true) {\n        return \"superfluous\"\n    }\n\n    // 2. Manual override: if marked as NOT superfluous BUT category is superfluous,\n    // we de-escalate it to 'comfort' (standard behavior for non-useless svago/altro).\n    if (transaction.isSuperfluous === false && categoryNature === \"superfluous\") {\n        return \"comfort\"\n    }\n\n    // 3. Fallback to category nature, with 'essential' as default for safety/unknowns\n    return categoryNature || \"essential\"\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/acvisuals/.gemini/antigravity/playground/numa-budget/src/features/dashboard/components/charts/premium-chart-section.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[583,586],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[583,586],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { ReactNode } from \"react\"\nimport { MacroSection } from \"@/components/patterns/macro-section\"\nimport { EChartsWrapper } from \"./echarts-wrapper\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport { StateMessage } from \"@/components/ui/state-message\"\nimport { useSettings } from \"@/features/settings/api/use-settings\"\nimport type { EChartsOption } from \"echarts\"\n\ninterface PremiumChartSectionProps {\n    title: string\n    description?: string\n    option: EChartsOption\n    isLoading?: boolean\n    hasData?: boolean\n    onEvents?: Record<string, (params: any) => void>\n    children?: ReactNode\n    className?: string\n    chartHeight?: number\n}\n\n/**\n * Reusable layout for \"Ultra-Tech\" charts.\n * Provvidenza radar backgrounds, glassmorphism, and unified premium styling.\n */\nexport function PremiumChartSection({\n    title,\n    description,\n    option,\n    isLoading,\n    hasData = true,\n    onEvents,\n    children,\n    className,\n    chartHeight = 520\n}: PremiumChartSectionProps) {\n    const { data: settings } = useSettings()\n    const isDarkMode = settings?.theme === \"dark\" || (settings?.theme === \"system\" && typeof window !== \"undefined\" && window.matchMedia(\"(prefers-color-scheme: dark)\").matches)\n\n    if (isLoading) {\n        return (\n            <MacroSection title={title} description=\"Caricamento in corso...\" className={className}>\n                <div style={{ height: chartHeight }}>\n                    <Skeleton className=\"h-full w-full rounded-3xl\" />\n                </div>\n            </MacroSection>\n        )\n    }\n\n    return (\n        <MacroSection\n            variant=\"premium\"\n            title={title}\n            description={description}\n            className={className}\n        >\n            {!hasData ? (\n                <div style={{ height: chartHeight }} className=\"flex items-center justify-center\">\n                    <StateMessage\n                        variant=\"empty\"\n                        title=\"Nessun dato\"\n                        description=\"I dati appariranno qui in questa vista ultra-tecnologica\"\n                    />\n                </div>\n            ) : (\n                <div className=\"flex flex-col items-center justify-center py-4\">\n                    <div className=\"w-full relative text-foreground px-8\" style={{ height: chartHeight }}>\n                        {/* Futuristic Background Accents (Radar) */}\n                        <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none opacity-40 dark:opacity-60\">\n                            <div className=\"w-[300px] h-[300px] border-[3px] border-primary/30 rounded-full animate-[ping_2.5s_cubic-bezier(0,0,0.2,1)_infinite]\" />\n                            <div className=\"absolute w-[300px] h-[300px] border border-primary/20 rounded-full animate-[ping_4s_cubic-bezier(0,0,0.2,1)_infinite]\" />\n                            <div className=\"absolute w-[400px] h-[400px] border border-primary/10 rounded-full\" />\n                            <div className=\"absolute w-[500px] h-[500px] border-t border-r border-primary/5 rounded-full\" />\n                        </div>\n\n                        <EChartsWrapper\n                            option={option}\n                            onEvents={onEvents}\n                        />\n                    </div>\n\n                    {/* Additional UI (like floating stats) */}\n                    {children}\n                </div>\n            )}\n        </MacroSection>\n    )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/acvisuals/.gemini/antigravity/playground/numa-budget/src/features/dashboard/components/charts/spending-composition-card.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4230,4233],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4230,4233],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":121,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":124,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4564,4567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4564,4567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6110,6113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6110,6113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":224,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9564,9567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9564,9567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10539,10542],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10539,10542],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":239,"column":132,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":239,"endColumn":135,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10596,10599],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10596,10599],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useMemo, useState } from \"react\"\nimport { useCurrency } from \"@/features/settings/api/use-currency\"\nimport { formatCents } from \"@/domain/money/currency\"\nimport { PremiumChartSection } from \"./premium-chart-section\"\nimport * as echarts from \"echarts\"\nimport { getCategoryById } from \"@/features/categories/config\"\nimport { useCategories } from \"@/features/categories/api/use-categories\"\nimport { useSettings } from \"@/features/settings/api/use-settings\"\nimport { Transaction } from \"@/features/transactions/api/types\"\nimport { DashboardTimeFilter } from \"../../api/types\"\n\ninterface SpendingCompositionCardProps {\n    transactions: Transaction[]\n    filter: DashboardTimeFilter\n    isLoading?: boolean\n}\n\nconst TOP_N_CATEGORIES = 5\nconst SYNTHETIC_ALTRI_ID = \"altro-synthetic\"\n\nexport function SpendingCompositionCard({ transactions, filter, isLoading: isExternalLoading }: SpendingCompositionCardProps) {\n    const { currency, locale } = useCurrency()\n    const { data: categories = [], isLoading: isCategoriesLoading } = useCategories()\n    const { data: settings } = useSettings()\n    const isDarkMode = settings?.theme === \"dark\" || (settings?.theme === \"system\" && typeof window !== \"undefined\" && window.matchMedia(\"(prefers-color-scheme: dark)\").matches)\n    const isLoading = isExternalLoading || isCategoriesLoading\n\n    const [highlightedCategory, setHighlightedCategory] = useState<string | null>(null)\n\n    const chartData = useMemo(() => {\n        if (!transactions || transactions.length === 0) return []\n\n        const periodTransactions = transactions.filter(t => {\n            const date = new Date(t.timestamp)\n            const startDate = new Date(filter.period + \"-01\")\n            startDate.setDate(1)\n\n            const endDate = new Date(filter.period + \"-01\")\n            endDate.setMonth(endDate.getMonth() + 1)\n            endDate.setDate(0)\n\n            if (filter.mode === \"range\" && filter.months) {\n                startDate.setMonth(startDate.getMonth() - (filter.months - 1))\n            }\n\n            return t.type === \"expense\" && date >= startDate && date <= endDate\n        })\n\n        const periodCategoryTotals: Record<string, number> = {}\n        periodTransactions.forEach(t => {\n            const val = Math.abs(t.amountCents)\n            periodCategoryTotals[t.categoryId] = (periodCategoryTotals[t.categoryId] || 0) + val\n        })\n\n        const sortedCategories = Object.entries(periodCategoryTotals)\n            .sort(([, a], [, b]) => b - a)\n\n        const topCats = sortedCategories.slice(0, TOP_N_CATEGORIES)\n        const othersSum = sortedCategories.slice(TOP_N_CATEGORIES)\n            .reduce((acc, [, val]) => acc + val, 0)\n\n        const data = topCats.map(([id, value]) => {\n            const config = getCategoryById(id, categories)\n            return {\n                id,\n                name: config?.label || \"Sconosciuta\",\n                value,\n                itemStyle: {\n                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [\n                        { offset: 0, color: config?.hexColor || \"#6366f1\" },\n                        { offset: 1, color: (config?.hexColor || \"#6366f1\") + \"88\" }\n                    ])\n                }\n            }\n        })\n\n        if (othersSum > 0) {\n            data.push({\n                id: SYNTHETIC_ALTRI_ID,\n                name: \"Altri\",\n                value: othersSum,\n                itemStyle: {\n                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [\n                        { offset: 0, color: \"#94a3b8\" },\n                        { offset: 1, color: \"#94a3b888\" }\n                    ])\n                }\n            })\n        }\n\n        return data\n    }, [transactions, filter, categories])\n\n    const option: echarts.EChartsOption = useMemo(() => {\n        if (!chartData.length) return {}\n        return {\n            tooltip: {\n                trigger: 'item',\n                backgroundColor: 'rgba(15, 23, 42, 0.95)',\n                borderColor: 'rgba(255, 255, 255, 0.1)',\n                borderWidth: 1,\n                padding: [12, 16],\n                textStyle: { color: '#f8fafc', fontSize: 13 },\n                formatter: (params: any) => {\n                    return `\n                        <div style=\"display: flex; flex-direction: column; gap: 4px;\">\n                            <div style=\"display: flex; align-items: center; gap: 8px;\">\n                                <div style=\"width: 8px; height: 8px; border-radius: 50%; background: ${(params.color as any).colorStops?.[0]?.color || params.color};\"></div>\n                                <span style=\"font-weight: 700; opacity: 0.8; text-transform: uppercase; font-size: 10px; tracking: 0.1em; color: #94a3b8;\">${params.name}</span>\n                            </div>\n                            <div style=\"display: flex; justify-content: space-between; align-items: baseline; gap: 24px;\">\n                                <span style=\"font-size: 16px; font-weight: 900; letter-spacing: -0.02em; color: #ffffff;\">${formatCents(params.value, currency, locale)}</span>\n                                <span style=\"font-size: 11px; font-weight: 700; color: #6366f1;\">${params.percent}%</span>\n                            </div>\n                        </div>\n                    `\n                }\n            },\n            series: [\n                {\n                    name: 'Composizione Spese',\n                    type: 'pie',\n                    radius: ['55%', '78%'],\n                    center: ['50%', '50%'],\n                    avoidLabelOverlap: true,\n                    itemStyle: {\n                        borderRadius: 16,\n                        borderColor: 'transparent',\n                        borderWidth: 4,\n                        shadowBlur: 30,\n                        shadowColor: 'rgba(0,0,0,0.25)'\n                    },\n                    label: {\n                        show: true,\n                        position: 'outside',\n                        padding: [0, -35],\n                        formatter: (params: any) => {\n                            return `{name|${params.name.toUpperCase()}}\\n{value|${formatCents(params.value, currency, locale)}}\\n{percent|${params.percent}%}`\n                        },\n                        rich: {\n                            name: {\n                                color: '#94a3b8',\n                                fontSize: 9,\n                                fontWeight: 800,\n                                padding: [0, 0, 4, 0],\n                                align: 'center'\n                            },\n                            value: {\n                                color: isDarkMode ? '#f8fafc' : '#1e293b',\n                                fontSize: 13,\n                                fontWeight: 900,\n                                padding: [0, 0, 2, 0],\n                                align: 'center'\n                            },\n                            percent: {\n                                color: '#6366f1',\n                                fontSize: 10,\n                                fontWeight: 800,\n                                align: 'center'\n                            }\n                        }\n                    },\n                    emphasis: {\n                        scale: true,\n                        scaleSize: 15,\n                        focus: 'self',\n                        itemStyle: {\n                            shadowBlur: 65,\n                            shadowColor: 'rgba(99, 102, 241, 0.65)'\n                        },\n                        label: {\n                            show: true,\n                            rich: {\n                                name: {\n                                    fontSize: 12,\n                                    fontWeight: 900,\n                                    padding: [0, 0, 8, 0],\n                                    color: isDarkMode ? '#f8fafc' : '#1e293b'\n                                },\n                                value: {\n                                    fontSize: 18,\n                                    fontWeight: 900,\n                                    padding: [0, 0, 4, 0]\n                                },\n                                percent: {\n                                    fontSize: 13,\n                                    fontWeight: 900\n                                }\n                            }\n                        }\n                    },\n                    blur: {\n                        label: {\n                            show: false\n                        },\n                        itemStyle: {\n                            opacity: 0.15,\n                            shadowBlur: 0\n                        },\n                        labelLine: {\n                            show: false\n                        }\n                    },\n                    data: chartData,\n                    animationType: 'scale',\n                    animationEasing: 'cubicOut',\n                    animationDuration: 1200\n                }\n            ],\n            graphic: []\n        }\n    }, [chartData, currency, locale, isDarkMode])\n\n    return (\n        <PremiumChartSection\n            title=\"Composizione Spese\"\n            description=\"Visualizzazione immersiva dell'andamento mensile\"\n            option={option}\n            isLoading={isLoading}\n            hasData={chartData.length > 0}\n            onEvents={{\n                'mouseover': (params: any) => setHighlightedCategory(params.data.id),\n                'mouseout': () => setHighlightedCategory(null)\n            }}\n        >\n            <div className=\"mt-4 flex flex-wrap justify-center gap-12\">\n                {chartData.slice(0, 3).map((item, idx) => (\n                    <div key={item.id} className=\"flex flex-col items-center gap-1.5 group cursor-default\">\n                        <span className=\"text-[10px] font-black uppercase tracking-[0.25em] text-muted-foreground/40 group-hover:text-primary transition-colors\">\n                            TOP {idx + 1}\n                        </span>\n                        <span className=\"text-sm font-bold text-foreground\">\n                            {item.name}\n                        </span>\n                        <div\n                            className=\"h-[3px] w-12 rounded-full transition-all duration-300 group-hover:w-16\"\n                            style={{ background: (item.itemStyle.color as any)?.colorStops?.[0]?.color || (item.itemStyle.color as any) }}\n                        />\n                    </div>\n                ))}\n            </div>\n        </PremiumChartSection>\n    )\n}\n","usedDeprecatedRules":[]}]
