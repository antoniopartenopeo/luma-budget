[{"filePath":"/Users/acvisuals/.gemini/antigravity/playground/numa-budget/src/features/dashboard/components/charts/spending-composition-card.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":298,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":301,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4570,4573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4570,4573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":312,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":315,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4584,4587],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4584,4587],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":355,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":358,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4627,4630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4627,4630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":548,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":551,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4820,4823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4820,4823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":878,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":881,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5150,5153],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5150,5153],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":1039,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":1042,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5311,5314],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5311,5314],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6264,6267],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6264,6267],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":127,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":130,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6334,6337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6334,6337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":192,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":195,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6399,6402],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6399,6402],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":214,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9748,9751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9748,9751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":214,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9761,9764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9761,9764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":229,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10700,10703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10700,10703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\"\n\nimport { useMemo, useState } from \"react\"\nimport { useCurrency } from \"@/features/settings/api/use-currency\"\nimport { formatCents } from \"@/domain/money/currency\"\nimport { PremiumChartSection } from \"./premium-chart-section\"\nimport * as echarts from \"echarts\"\nimport { getCategoryById } from \"@/features/categories/config\"\nimport { useCategories } from \"@/features/categories/api/use-categories\"\nimport { useSettings } from \"@/features/settings/api/use-settings\"\nimport { Transaction } from \"@/features/transactions/api/types\"\nimport { DashboardTimeFilter } from \"../../api/types\"\n\ninterface SpendingCompositionCardProps {\n    transactions: Transaction[]\n    filter: DashboardTimeFilter\n    isLoading?: boolean\n}\n\nconst TOP_N_CATEGORIES = 5\nconst SYNTHETIC_ALTRI_ID = \"altro-synthetic\"\n\nexport function SpendingCompositionCard({ transactions, filter, isLoading: isExternalLoading }: SpendingCompositionCardProps) {\n    const { currency, locale } = useCurrency()\n    const { data: categories = [], isLoading: isCategoriesLoading } = useCategories()\n    const { data: settings } = useSettings()\n    const isDarkMode = settings?.theme === \"dark\" || (settings?.theme === \"system\" && typeof window !== \"undefined\" && window.matchMedia(\"(prefers-color-scheme: dark)\").matches)\n    const isLoading = isExternalLoading || isCategoriesLoading\n\n    const [highlightedCategory, setHighlightedCategory] = useState<string | null>(null)\n\n    const chartData = useMemo(() => {\n        if (!transactions || transactions.length === 0) return []\n\n        const periodTransactions = transactions.filter(t => {\n            const date = new Date(t.timestamp)\n            const startDate = new Date(filter.period + \"-01\")\n            startDate.setDate(1)\n\n            const endDate = new Date(filter.period + \"-01\")\n            endDate.setMonth(endDate.getMonth() + 1)\n            endDate.setDate(0)\n\n            if (filter.mode === \"range\" && filter.months) {\n                startDate.setMonth(startDate.getMonth() - (filter.months - 1))\n            }\n\n            return t.type === \"expense\" && date >= startDate && date <= endDate\n        })\n\n        const periodCategoryTotals: Record<string, number> = {}\n        periodTransactions.forEach(t => {\n            const val = Math.abs(t.amountCents)\n            periodCategoryTotals[t.categoryId] = (periodCategoryTotals[t.categoryId] || 0) + val\n        })\n\n        const sortedCategories = Object.entries(periodCategoryTotals)\n            .sort(([, a], [, b]) => b - a)\n\n        const topCats = sortedCategories.slice(0, TOP_N_CATEGORIES)\n        const othersSum = sortedCategories.slice(TOP_N_CATEGORIES)\n            .reduce((acc, [, val]) => acc + val, 0)\n\n        const data = topCats.map(([id, value]) => {\n            const config = getCategoryById(id, categories)\n            return {\n                id,\n                name: config?.label || \"Sconosciuta\",\n                value,\n                itemStyle: {\n                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [\n                        { offset: 0, color: config?.hexColor || \"#6366f1\" },\n                        { offset: 1, color: (config?.hexColor || \"#6366f1\") + \"88\" }\n                    ])\n                }\n            }\n        })\n\n        if (othersSum > 0) {\n            data.push({\n                id: SYNTHETIC_ALTRI_ID,\n                name: \"Altri\",\n                value: othersSum,\n                itemStyle: {\n                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [\n                        { offset: 0, color: \"#94a3b8\" },\n                        { offset: 1, color: \"#94a3b888\" }\n                    ])\n                }\n            })\n        }\n\n        return data\n    }, [transactions, filter, categories])\n\n    const option: echarts.EChartsOption = useMemo(() => {\n        if (!chartData.length) return {}\n        return {\n            tooltip: {\n                trigger: 'item',\n                backgroundColor: 'rgba(15, 23, 42, 0.95)',\n                borderColor: 'rgba(255, 255, 255, 0.1)',\n                borderWidth: 1,\n                padding: [12, 16],\n                textStyle: { color: '#f8fafc', fontSize: 13 },\n                formatter: (params: unknown) => {\n                    return `\n                        <div style=\\\"display: flex; flex-direction: column; gap: 4px;\\\">\\n                            <div style=\\\"display: flex; align-items: center; gap: 8px;\\\">\\n                                <div style=\\\"width: 8px; height: 8px; border-radius: 50%; background: ${((params as any).color as any)?.colorStops?.[0]?.color || (params as any).color};\\\"></div>\\n                                <span style=\\\"font-weight: 700; opacity: 0.8; text-transform: uppercase; font-size: 10px; tracking: 0.1em; color: #94a3b8;\\\">${(params as any).name}</span>\\n                            </div>\\n                            <div style=\\\"display: flex; justify-content: space-between; align-items: baseline; gap: 24px;\\\">\\n                                <span style=\\\"font-size: 16px; font-weight: 900; letter-spacing: -0.02em; color: #ffffff;\\\">${formatCents((params as any).value as number, currency, locale)}</span>\\n                                <span style=\\\"font-size: 11px; font-weight: 700; color: #6366f1;\\\">${(params as any).percent}%</span>\\n                            </div>\\n                        </div>\\n                    `\n                }\n            },\n            series: [\n                {\n                    name: 'Composizione Spese',\n                    type: 'pie',\n                    radius: ['55%', '78%'],\n                    center: ['50%', '50%'],\n                    avoidLabelOverlap: true,\n                    itemStyle: {\n                        borderRadius: 16,\n                        borderColor: 'transparent',\n                        borderWidth: 4,\n                        shadowBlur: 30,\n                        shadowColor: 'rgba(0,0,0,0.25)'\n                    },\n                    label: {\n                        show: true,\n                        position: 'outside',\n                        padding: [0, -35],\n                        formatter: (params: unknown) => {\n                            return `{name|${((params as any).name as string).toUpperCase()}}\\n{value|${formatCents((params as any).value as number, currency, locale)}}\\n{percent|${(params as any).percent}%}`\n                        },\n                        rich: {\n                            name: {\n                                color: '#94a3b8',\n                                fontSize: 9,\n                                fontWeight: 800,\n                                padding: [0, 0, 4, 0],\n                                align: 'center'\n                            },\n                            value: {\n                                color: isDarkMode ? '#f8fafc' : '#1e293b',\n                                fontSize: 13,\n                                fontWeight: 900,\n                                padding: [0, 0, 2, 0],\n                                align: 'center'\n                            },\n                            percent: {\n                                color: '#6366f1',\n                                fontSize: 10,\n                                fontWeight: 800,\n                                align: 'center'\n                            }\n                        }\n                    },\n                    emphasis: {\n                        scale: true,\n                        scaleSize: 15,\n                        focus: 'self',\n                        itemStyle: {\n                            shadowBlur: 65,\n                            shadowColor: 'rgba(99, 102, 241, 0.65)'\n                        },\n                        label: {\n                            show: true,\n                            rich: {\n                                name: {\n                                    fontSize: 12,\n                                    fontWeight: 900,\n                                    padding: [0, 0, 8, 0],\n                                    color: isDarkMode ? '#f8fafc' : '#1e293b'\n                                },\n                                value: {\n                                    fontSize: 18,\n                                    fontWeight: 900,\n                                    padding: [0, 0, 4, 0]\n                                },\n                                percent: {\n                                    fontSize: 13,\n                                    fontWeight: 900\n                                }\n                            }\n                        }\n                    },\n                    blur: {\n                        label: {\n                            show: false\n                        },\n                        itemStyle: {\n                            opacity: 0.15,\n                            shadowBlur: 0\n                        },\n                        labelLine: {\n                            show: false\n                        }\n                    },\n                    data: chartData,\n                    animationType: 'scale',\n                    animationEasing: 'cubicOut',\n                    animationDuration: 1200\n                }\n            ],\n            graphic: []\n        }\n    }, [chartData, currency, locale, isDarkMode])\n\n    return (\n        <PremiumChartSection\n            title=\"Composizione Spese\"\n            description=\"Visualizzazione immersiva dell'andamento mensile\"\n            option={option}\n            isLoading={isLoading}\n            hasData={chartData.length > 0}\n            onEvents={{\n                'mouseover': (params: unknown) => setHighlightedCategory(((params as any).data as any).id),\n                'mouseout': () => setHighlightedCategory(null)\n            }}\n        >\n            <div className=\"mt-4 flex flex-wrap justify-center gap-12\">\n                {chartData.slice(0, 3).map((item, idx) => (\n                    <div key={item.id} className=\"flex flex-col items-center gap-1.5 group cursor-default\">\n                        <span className=\"text-[10px] font-black uppercase tracking-[0.25em] text-muted-foreground/40 group-hover:text-primary transition-colors\">\n                            TOP {idx + 1}\n                        </span>\n                        <span className=\"text-sm font-bold text-foreground\">\n                            {item.name}\n                        </span>\n                        <div\n                            className=\"h-[3px] w-12 rounded-full transition-all duration-300 group-hover:w-16\"\n                            style={{ background: ((item.itemStyle?.color as any)?.colorStops?.[0]?.color || item.itemStyle?.color) as string }}\n                        />\n                    </div>\n                ))}\n            </div>\n        </PremiumChartSection>\n    )\n}\n","usedDeprecatedRules":[]}]
